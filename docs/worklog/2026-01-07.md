# 作業ログ（2026-01-07）

## サマリ
- Windows 環境で Git が `Filename too long` になる問題に対処するため、対象ディレクトリ配下のディレクトリ名/ファイル名を短縮するスクリプトを作成し、Git の add が失敗しない状態にした。
- その後 GitHub への push が `GH001: Large files detected` で拒否される問題に遭遇し、原因（100MB 制限）を特定。
- 問題の大容量データ（ChatGPT データエクスポート一式）を Git 管理外に移し、コミットを修正（amend）して push を成功させた。

## 背景 / 目的
- 個人データ・実験データを含む `src/lib/pesonaldata/unlabeldata` 配下を扱っていたが、
  - Windows のパス長制限（いわゆる MAX_PATH 近辺）により Git 操作で失敗
  - GitHub 側の 1ファイル 100MB 制限により push が拒否
  という2系統の課題が発生した。

## 直面した課題
### 1) Windows のパス長制限で Git が失敗
- 症状
  - `git add` 等で `Filename too long` が発生。
  - 深い階層・長いファイル名（特に画像生成系の出力など）で顕在化。
- 影響
  - 変更をステージできず、コミット・push が進められない。

### 2) GitHub の 100MB 制限で push が拒否
- 症状（push 失敗ログの要点）
  - `chat.html` が約 109.82MB
  - `conversations.json` が約 109.31MB
  - `GH001: Large files detected` により pre-receive hook が拒否
- 影響
  - リモートに push できない。

## 実施した解決方法
### 1) パス長問題の対処（ファイル名/ディレクトリ名の短縮）
- 対応内容
  - ルールベースでディレクトリ名（例: `d0001`）やファイル名（例: `f0000.png`）に置換して短縮。
  - Windows のロングパス対応のため、`\\?\` プレフィックス等を考慮したリネーム処理を実装。
- 追加したもの
  - `scripts/shorten_unlabeldata_paths.py`
    - `src/lib/pesonaldata/unlabeldata` 配下を対象に、長いパスを短縮する。
    - 走査（`os.walk`）・リネーム・衝突回避・dry-run などを考慮。
- 結果
  - `git add` が `Filename too long` で落ちなくなり、ステージまで進める状態に改善。

### 2) GitHub 100MB 制限の対処（大容量データを Git 管理外へ）
- 解析結果（何のデータか）
  - `chat.html`:
    - HTML タイトルに `ChatGPT Data Export` を含む。
    - `var jsonData = [...]` として会話データが埋め込まれたエクスポート。
  - `conversations.json`:
    - JSON 配列 `[...]` の会話エクスポート。
    - `title/create_time/update_time/mapping` 等を含む、ChatGPT の会話ツリー構造。
  - 上記2つは形式違いでデータ内容が重複している可能性が高い。

- 方針
  - これらはアプリ本体のソースコードではなく、サイズ面・プライバシー面の観点でも GitHub に入れない方が安全。
  - よって「Git 管理外に移す（ローカルには残す）」を採用。

- 実施内容
  - `.gitignore` に追加
    - `/src/lib/pesonaldata/unlabeldata/`
  - Git のインデックスから除外（ローカルのファイルは保持）
    - `git rm -r --cached -- src/lib/pesonaldata/unlabeldata`
  - 直近コミットに反映
    - `git commit --amend --no-edit`
  - push
    - `git push --force-with-lease origin master`

- 結果
  - GitHub 側の `Large files detected` による push 失敗が解消し、push が成功。
  - 今後 `unlabeldata` を誤ってコミットしない状態になった。

## 補足メモ
- `src/lib/pesonaldata/limitlessexport.py` が空ファイルのため、今後実装予定なら用途を README 等に追記する。
- Windows 環境では CRLF 変換警告（LF -> CRLF）が出ることがあるが、今回の主要因ではなかった。

## 次回の確認ポイント
- `node-v25.2.1-win-x64/` や巨大な依存物がリポジトリに入ると肥大化しやすい。
  - リポジトリ運用方針として「何をコミット対象にするか」を明確化する（.gitignore の見直し）。
- 実験データは
  - 小さなサンプルのみ同梱
  - 大容量・個人データは別保管（例: ローカル / 社内ストレージ / LFS / オブジェクトストレージ）
  などの運用に寄せる。
